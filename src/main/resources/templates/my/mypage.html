<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/basic}" lang="ko">
<meta charset="UTF-8">
<div layout:fragment="content">
    <h1 class="mt-4">My Page</h1>

    <div class="accordion" id="myPageAccordion">
        <!-- 회원정보 섹션 -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingProfile">
                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseProfile" aria-expanded="true" aria-controls="collapseProfile">
                    회원정보
                </button>
            </h2>
            <div id="collapseProfile" class="accordion-collapse collapse show" aria-labelledby="headingProfile"
                 data-bs-parent="#myPageAccordion">
                <div class="accordion-body">
                    <div class="row mb-3">
                        <div class="col-md-4 text-center">
                            <img th:src="${user.profileImagePath != null ? user.profileImagePath : '/images/noImage.jpg'}"
                                 alt="프로필 이미지" class="img-fluid rounded-circle" style="max-width: 200px;">
                        </div>
                        <div class="col-md-8">
                            <p><strong>아이디:</strong> <span th:text="${user.loginId}"></span></p>
                            <p><strong>이메일:</strong> <span th:text="${user.email}"></span></p>
                            <!-- <p><strong>가입일:</strong> <span th:text="${#dates.format(user.regDate, 'yyyy-MM-dd HH:mm:ss')}"></span></p> -->
                            <p><strong>가입날짜:</strong> <span th:text="${#temporals.format(user.regDate, 'yyyy-MM-dd HH:mm:ss')}"></span></p>
                            <p><strong>닉네임:</strong> <span th:text="${user.nickname}"></span></p>
                            <p><strong>소개:</strong> <span th:text="${user.introduce}">소개 없음</span></p>
                        </div>
                    </div>
                    <div class="text-end">
                        <a th:href="@{/profile/{userId}/updateMyProfile(userId=${user.userId})}" class="btn btn-primary d-inline">수정</a>
                        <form action="/delete" method="post" onsubmit="return confirm('탈퇴하시겠습니까?');" class="d-inline-block">
                            <input type="hidden" name="userId" th:value="${userId}" />
                            <button type="submit" class="btn btn-danger">탈퇴</button>
                        </form>
                    </div>

                </div>
            </div>
        </div>

        <!-- 내 게시물 섹션 -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingPosts">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapsePosts" aria-expanded="false" aria-controls="collapsePosts">
                    내 게시물
                </button>
            </h2>
            <div id="collapsePosts" class="accordion-collapse collapse" aria-labelledby="headingPosts"
                 data-bs-parent="#myPageAccordion">
                <div class="accordion-body">
                    <table class="table table-hover mt-3">
                        <thead>
                        <tr>
                            <th scope="col">번호</th>
                            <th scope="col">제목</th>
                            <th scope="col">작성자</th>
                            <th scope="col">작성 날짜</th>
                            <th scope="col">삭제</th>
                        </tr>
                        </thead>
                        <tbody>
                        <!-- 게시글 목록을 반복하여 출력 -->
                        <tr th:each="board, iterStat : ${boards}">
                            <th scope="row" th:text="${iterStat.count}"></th> <!-- 순번 -->
                            <td>
                                <a th:href="@{'/read/'+ ${board.boardId}}" th:text="${board.title}">제목</a>
                            </td>
                            <td th:text="${board.userLoginId}">작성자</td>
                            <td th:text="${#temporals.format(board.regDate, 'yyyy-MM-dd HH:mm')}">작성 날짜</td>
                            <td>
                                <form th:action="@{/delete/{userId}/{boardId}(userId=${board.userId}, boardId=${board.boardId})}" method="post" onsubmit="return confirm('정말 삭제하시겠습니까?');">
                                    <button type="submit" class="btn btn-danger btn-sm">삭제</button>
                                </form>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 내 댓글 섹션 -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingComments">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseComments" aria-expanded="false"
                        aria-controls="collapseComments">
                    내 댓글
                </button>
            </h2>
            <div id="collapseComments" class="accordion-collapse collapse" aria-labelledby="headingComments"
                 data-bs-parent="#myPageAccordion">
                <div class="accordion-body">
                    <table class="table table-hover mt-3">
                        <thead>
                        <tr>
                            <th scope="col">번호</th>
                            <th scope="col">댓글 내용</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="reply, iterStat : ${replies}">
                            <th scope="row" th:text="${iterStat.count}">번호</th>
                            <td th:text="${reply.content}">댓글 내용</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 내 북마크 섹션 -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingBookmarks">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseBookmarks" aria-expanded="false"
                        aria-controls="collapseBookmarks">
                    내 북마크
                </button>
            </h2>
            <div id="collapseBookmarks" class="accordion-collapse collapse" aria-labelledby="headingBookmarks"
                 data-bs-parent="#myPageAccordion">
                <div class="accordion-body">
                    <table class="table table-hover mt-3">
                        <thead>
                        <tr>
                            <th scope="col">번호</th>
                            <th scope="col">제목</th>
                            <th scope="col">작성자</th>
                            <th scope="col">작성 날짜</th>
                            <th scope="col">삭제</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="bookmark, iterStat : ${bookmarks}">
                            <th scope="row" th:text="${iterStat.count}">번호</th>

                            <!-- 제목 링크 - bookmark.boardId가 null이 아닌 경우에만 표시 -->
                            <td th:if="${bookmark.boardId != null}">
                                <a th:href="@{/read/{boardId}(boardId=${bookmark.boardId})}"
                                   th:text="${bookmark.title}">제목</a>
                            </td>
                            <!-- board가 null인 경우를 대비하여 제목을 대체 텍스트로 표시 -->
                            <td th:if="${bookmark.boardId == null}">
                                <span>정보 없음</span>
                            </td>

                            <!-- 작성자 및 작성 날짜 - board가 null이 아닌 경우만 접근 -->
                            <td th:text="${bookmark.boardId != null ? bookmark.userNickname : '정보 없음'}">작성자</td>
                            <td th:text="${bookmark.boardId != null ? #temporals.format(bookmark.regDate, 'yyyy-MM-dd HH:mm') : ''}">작성 날짜</td>

                            <!-- 삭제 폼 -->
                            <td>
                                <form th:action="@{/bookmarkDelete/{userId}/{boardId}(userId=${bookmark.userId}, boardId=${bookmark.boardId})}"
                                      method="post" onsubmit="return confirm('북마크를 삭제하시겠습니까?');">
                                    <button type="submit" class="btn btn-danger btn-sm" th:disabled="${bookmark.boardId == null}">삭제</button>
                                </form>

                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>




<!--<!DOCTYPE html>-->
<!--<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"-->
<!--      xmlns:th="http://www.thymeleaf.org"-->
<!--      layout:decorate="~{layout/basic.html}">-->

<!--<body>-->
<!--    <div layout:decorate="content">-->
<!--        &lt;!&ndash; Page content with Accordion &ndash;&gt;-->
<!--        <div class="container card-container shadow-sm">-->
<!--            <h1 class="mt-4">My Page</h1>-->

<!--            <div class="accordion" id="myPageAccordion">-->
<!--                &lt;!&ndash; 회원정보 섹션 &ndash;&gt;-->
<!--                <div class="accordion-item">-->
<!--                    <h2 class="accordion-header" id="headingProfile">-->
<!--                        <button class="accordion-button" type="button" data-bs-toggle="collapse"-->
<!--                                data-bs-target="#collapseProfile" aria-expanded="true" aria-controls="collapseProfile">-->
<!--                            회원정보-->
<!--                        </button>-->
<!--                    </h2>-->
<!--                    <div id="collapseProfile" class="accordion-collapse collapse show" aria-labelledby="headingProfile"-->
<!--                         data-bs-parent="#myPageAccordion">-->
<!--                        <div class="accordion-body">-->
<!--                            <a th:href="@{/profile/{userId}(userId=${userId})}">프로필 조회</a><br>-->
<!--                            <a th:href="@{/profile/{userId}/updateMyProfile(userId=${userId})}">프로필 수정</a><br>-->
<!--                            <form action="/delete" method="post" onsubmit="return confirm('탈퇴하시겠습니까?');">-->
<!--                                <button type="submit" class="btn btn-danger">탈퇴</button>-->
<!--                            </form>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->

<!--                &lt;!&ndash; 내 게시물 섹션 &ndash;&gt;-->
<!--                <div class="accordion-item">-->
<!--                    <h2 class="accordion-header" id="headingPosts">-->
<!--                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"-->
<!--                                data-bs-target="#collapsePosts" aria-expanded="false" aria-controls="collapsePosts">-->
<!--                            내 게시물-->
<!--                        </button>-->
<!--                    </h2>-->
<!--                    <div id="collapsePosts" class="accordion-collapse collapse" aria-labelledby="headingPosts"-->
<!--                         data-bs-parent="#myPageAccordion">-->
<!--                        <div class="accordion-body">-->
<!--                            <a th:href="@{/myBoardList}">게시물 조회</a><br>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->

<!--                &lt;!&ndash; 내 댓글 섹션 &ndash;&gt;-->
<!--                <div class="accordion-item">-->
<!--                    <h2 class="accordion-header" id="headingComments">-->
<!--                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"-->
<!--                                data-bs-target="#collapseComments" aria-expanded="false"-->
<!--                                aria-controls="collapseComments">-->
<!--                            내 댓글-->
<!--                        </button>-->
<!--                    </h2>-->
<!--                    <div id="collapseComments" class="accordion-collapse collapse" aria-labelledby="headingComments"-->
<!--                         data-bs-parent="#myPageAccordion">-->
<!--                        <div class="accordion-body">-->
<!--                            <a th:href="@{/myReplyList}">댓글 조회</a>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->

<!--                &lt;!&ndash; 내 북마크 섹션 &ndash;&gt;-->
<!--                <div class="accordion-item">-->
<!--                    <h2 class="accordion-header" id="headingBookmarks">-->
<!--                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"-->
<!--                                data-bs-target="#collapseBookmarks" aria-expanded="false"-->
<!--                                aria-controls="collapseBookmarks">-->
<!--                            내 북마크-->
<!--                        </button>-->
<!--                    </h2>-->
<!--                    <div id="collapseBookmarks" class="accordion-collapse collapse" aria-labelledby="headingBookmarks"-->
<!--                         data-bs-parent="#myPageAccordion">-->
<!--                        <div class="accordion-body">-->
<!--                            <a th:href="@{/myBookmarkList}">북마크 조회</a><br>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--</body>-->